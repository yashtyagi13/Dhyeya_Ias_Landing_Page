{"version":3,"sources":["../../../../src/app-router/client/useAwaitableNavigate.ts"],"sourcesContent":["'use client';\n\nimport { useRouter } from 'next/navigation';\nimport { useEffect, useRef, useTransition } from 'react';\n\ntype NavigateFunction = ReturnType<typeof useRouter>['push'];\n\n/**\n * Creates an \"awaitable\" navigation function that will do its best effort to wait for Next.js to finish its route transition.\n *\n * This is accomplished by wrapping the call to `router.push` in `startTransition()`, which should rely on React to coordinate the pending state. We key off of\n * `isPending` to flush the stored promises and ensure the navigates \"resolve\".\n */\nexport const useAwaitableNavigate = () => {\n  // eslint-disable-next-line @typescript-eslint/unbound-method\n  const { push } = useRouter();\n  const [isPending, startTransition] = useTransition();\n  const clerkNavRef = useRef<(...args: Parameters<NavigateFunction>) => Promise<void>>();\n  const clerkNavPromiseBuffer = useRef<(() => void)[]>([]);\n\n  // Set the navigation function reference only once\n  if (!clerkNavRef.current) {\n    clerkNavRef.current = (to, opts) => {\n      return new Promise<void>(res => {\n        clerkNavPromiseBuffer.current.push(res);\n        startTransition(() => {\n          push(to, opts);\n        });\n      });\n    };\n  }\n\n  // Handle flushing the promise buffer when pending is false. If pending is false and there are promises in the buffer we should be able to safely flush them.\n  useEffect(() => {\n    if (isPending) {\n      return;\n    }\n\n    if (clerkNavPromiseBuffer?.current?.length) {\n      clerkNavPromiseBuffer.current.forEach(resolve => resolve());\n    }\n    clerkNavPromiseBuffer.current = [];\n  }, [isPending]);\n\n  return clerkNavRef.current;\n};\n"],"mappings":";;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA,wBAA0B;AAC1B,mBAAiD;AAU1C,MAAM,uBAAuB,MAAM;AAExC,QAAM,EAAE,KAAK,QAAI,6BAAU;AAC3B,QAAM,CAAC,WAAW,eAAe,QAAI,4BAAc;AACnD,QAAM,kBAAc,qBAAiE;AACrF,QAAM,4BAAwB,qBAAuB,CAAC,CAAC;AAGvD,MAAI,CAAC,YAAY,SAAS;AACxB,gBAAY,UAAU,CAAC,IAAI,SAAS;AAClC,aAAO,IAAI,QAAc,SAAO;AAC9B,8BAAsB,QAAQ,KAAK,GAAG;AACtC,wBAAgB,MAAM;AACpB,eAAK,IAAI,IAAI;AAAA,QACf,CAAC;AAAA,MACH,CAAC;AAAA,IACH;AAAA,EACF;AAGA,8BAAU,MAAM;AAjClB;AAkCI,QAAI,WAAW;AACb;AAAA,IACF;AAEA,SAAI,oEAAuB,YAAvB,mBAAgC,QAAQ;AAC1C,4BAAsB,QAAQ,QAAQ,aAAW,QAAQ,CAAC;AAAA,IAC5D;AACA,0BAAsB,UAAU,CAAC;AAAA,EACnC,GAAG,CAAC,SAAS,CAAC;AAEd,SAAO,YAAY;AACrB;","names":[]}